<!DOCTYPE html>
<html>
	<head>
		<title>Piikkilista (dev)</title>
		<meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.8.1/jquery.min.js" type="text/javascript"></script>
		<script src="source/jquery.fancybox.pack.js?v=2.1.0"></script>
		<link rel="stylesheet" href="source/jquery.fancybox.css?v=2.1.0" type="text/css" media="screen" />
		<style>
		</style>
		<script type="text/javascript">
			$(document).ready(function() {
				var loginContainer = $('.login');
				//setup fancybox
				$('.fancybox').fancybox({
					afterClose : function() {
						var loggedUser = $.data(loginContainer, 'user');
						if (loggedUser == undefined) {
							$('.loggedUser').html('(not logged in)');
						} else {
							$('.loggedUser').html('Moi ' + loggedUser);
						}
					}
				});

				//force user selection, if not "logged" in
				if ($.data(loginContainer, 'user') == undefined)
					$('.fancybox').click();

				//read user selection
				$('.user').click(function() {
					$.data(loginContainer, 'user', $(this).attr('name'));
					$.data(loginContainer, 'accountValue', 42);
					$.fancybox.close();
					refresh();
				});

				//update all data fields and save data to database
				function refresh() {
					$('#accountValue').html($.data(loginContainer, 'accountValue'));
				}

				//buying a product functionality
				$('.product').click(function() {
					var productPrice = parseFloat($(this).attr('value'));
					saveData(productPrice);
				});
				
				function saveData(price) {
					$.post('data.php',{
						'user':$.data(loginContainer,'user'),
						'amount':price
					}, function(data) {
						$.data(loginContainer, 'accountValue', parseInt(data));
						refresh();
						console.log(data);
					},'json');
				}

				function loadData() {
					$.post('data.php',{
						'user':$.data(loginContainer,'user')
					}, function(data) {
						$.data(loginContainer, 'accountValue', parseInt(data));
						refresh();
						console.log(data);
					},'json');
				}

			});
		</script>
	</head>
	<body>

		<div id="login" style="display: none;">
			<h1>Valitse piikki</h1>
			<section name="login">
				<button type="button" class="user" name="testi">
					testi
				</button>
				<button type="button" class="user" name="oldskool">
					oldskool
				</button>
				<button type="button" class="user" name="stream.ry">
					stream.ry
				</button>
			</section>
		</div>

		<header>
			<h1>Piikkilista</h1>
			<span class="loggedUser"> (not logged in) </span>
			<button type="button" href="#login" class="fancybox">
				Vaihda piikki√§
			</button>
		</header>
		<section name="store">
			<article class="category">
				<h2>juomat1</h2>
				<p>
					<button type="button" class="product" name="tuote1" value="1">
						tuote1
					</button>
					<button type="button" class="product" name="tuote2" value="3.5">
						tuote2
					</button>
					<button type="button" class="product" name="tuote3" value="2">
						tuote3
					</button>
				</p>
			</article>
		</section>
		<aside name="stats">
			<article>
				<h2>Stats</h2>
				<p>
					Saldo: <span id="accountValue">0</span>
				</p>
			</article>
		</aside>
		<footer>

		</footer>
	</body>
</html>